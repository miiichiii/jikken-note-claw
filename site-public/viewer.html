<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Viewer - Mission Control</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.6/purify.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .glass-header {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        /* Markdown Styles */
        .prose h1 { @apply text-3xl font-bold mb-4 mt-8 text-slate-800; }
        .prose h2 { @apply text-2xl font-semibold mb-3 mt-6 text-slate-800; }
        .prose h3 { @apply text-xl font-semibold mb-2 mt-4 text-slate-800; }
        .prose p { @apply mb-4 leading-relaxed text-slate-600; }
        .prose ul { @apply list-disc list-outside ml-6 mb-4 text-slate-600; }
        .prose ol { @apply list-decimal list-outside ml-6 mb-4 text-slate-600; }
        .prose li { @apply mb-1; }
        .prose a { @apply text-rose-500 hover:text-rose-600 underline; }
        .prose code { @apply bg-slate-100 text-slate-800 px-1 py-0.5 rounded text-sm font-mono; }
        .prose pre { @apply bg-slate-800 text-slate-100 p-4 rounded-lg overflow-x-auto mb-4; }
        .prose pre code { @apply bg-transparent text-inherit p-0; }
        .prose blockquote { @apply border-l-4 border-rose-200 pl-4 italic text-slate-500 my-4; }
        .prose img { @apply rounded-lg shadow-md max-w-full h-auto my-4; }
        .prose hr { @apply my-8 border-slate-200; }
        .prose table { @apply w-full border-collapse mb-4; }
        .prose th { @apply border-b-2 border-slate-200 p-2 text-left font-semibold text-slate-700; }
        .prose td { @apply border-b border-slate-100 p-2 text-slate-600; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen pb-12">
    
    <!-- Header -->
    <header class="sticky top-0 z-50 glass-header px-6 py-4 shadow-sm">
        <div class="max-w-4xl mx-auto flex items-center justify-between">
            <a href="memory.html" class="flex items-center gap-2 text-slate-500 hover:text-slate-800 transition-colors group">
                <div class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center group-hover:bg-rose-100 group-hover:text-rose-500 transition-colors">
                    <i class="fa-solid fa-arrow-left"></i>
                </div>
                <span class="font-medium">Back to Memory</span>
            </a>
            <div class="flex gap-2">
                <a id="rawLink" href="#" target="_blank" class="text-xs font-mono text-slate-400 hover:text-rose-500 bg-slate-100 px-3 py-1.5 rounded-full transition-colors">
                    <i class="fa-solid fa-code mr-1"></i> Raw
                </a>
            </div>
        </div>
    </header>

    <!-- Content -->
    <main class="max-w-4xl mx-auto px-6 py-8">
        <article class="glass-card rounded-2xl p-8 md:p-12 min-h-[60vh]">
            <div id="loader" class="flex flex-col items-center justify-center py-20 text-slate-400">
                <i class="fa-solid fa-circle-notch fa-spin text-3xl mb-4 text-rose-400"></i>
                <p>Loading document...</p>
            </div>
            
            <div id="error" class="hidden text-center py-20">
                <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-rose-100 text-rose-500 mb-4">
                    <i class="fa-solid fa-triangle-exclamation text-2xl"></i>
                </div>
                <h2 class="text-xl font-bold text-slate-800 mb-2">Failed to load file</h2>
                <p id="errorMessage" class="text-slate-500">The requested file could not be found or read.</p>
                <a href="memory.html" class="inline-block mt-6 px-6 py-2 bg-slate-800 text-white rounded-lg hover:bg-slate-700 transition-colors">Return to Index</a>
            </div>

            <div id="content" class="prose max-w-none hidden">
                <!-- Markdown content will be injected here -->
            </div>
        </article>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const file = urlParams.get('file');
            const loader = document.getElementById('loader');
            const error = document.getElementById('error');
            const errorMessage = document.getElementById('errorMessage');
            const content = document.getElementById('content');
            const rawLink = document.getElementById('rawLink');

            if (!file) {
                showError('No file specified.');
                return;
            }

            // Security check: ensure file path is within allowed directories (basic check)
            // In a real app, this should be handled by the server, but for static site, we just fetch.
            // We can check if it starts with 'memory/' to be safe-ish.
            if (!file.startsWith('memory/')) {
                 // Optional: warn but allow for now if structure varies
                 console.warn('File path does not start with memory/', file);
            }

            // Update Raw Link
            rawLink.href = file;

            fetch(file)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.text();
                })
                .then(text => {
                    // Configure marked
                    marked.use({
                        gfm: true,
                        breaks: true
                    });

                    // Parse Markdown
                    const html = marked.parse(text);
                    
                    // Sanitize HTML
                    const cleanHtml = DOMPurify.sanitize(html);

                    // Inject
                    content.innerHTML = cleanHtml;
                    
                    // Update Title if H1 exists
                    const h1 = content.querySelector('h1');
                    if (h1) {
                        document.title = `${h1.innerText} - Memory Viewer`;
                    } else {
                        document.title = `${file.split('/').pop()} - Memory Viewer`;
                    }

                    // Show Content
                    loader.classList.add('hidden');
                    content.classList.remove('hidden');
                })
                .catch(err => {
                    console.error('Fetch error:', err);
                    showError(`Could not load ${file}. ${err.message}`);
                });

            function showError(msg) {
                loader.classList.add('hidden');
                error.classList.remove('hidden');
                errorMessage.textContent = msg;
            }
        });
    </script>
</body>
</html>